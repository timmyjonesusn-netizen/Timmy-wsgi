<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Timmy Bubbles</title>
    <link rel="stylesheet" href="/static/style.css" />
</head>
<body>

    <!-- Bubble canvas / glowing background lives behind everything -->
    <div class="bg-gradient"></div>
    <canvas id="bubbleCanvas"></canvas>

    <!-- Top bar with Timmy + live visitor counter -->
    <header class="timmy-bar">
        <div class="timmy-left">TIMMY</div>
        <div class="timmy-right">
            <span class="vis-label">Visitors:</span>
            <span class="visit-num">{{ visit_count }}</span>
        </div>
    </header>

    <!-- Main content card -->
    <main class="main-card">
        <h1 class="headline">Timmy’s Bubble Mixes</h1>

        <div class="playlist-grid">
            {% for p in playlists %}
            <a class="playlist-btn"
               href="{{ p.url }}"
               target="_blank"
               rel="noopener noreferrer">
                {{ p.label }}
            </a>
            {% endfor %}
        </div>

        <p class="credit">
            App made on iPhone 17 Pro Max • Timmy Bubbles
        </p>
    </main>

    <!-- Bubble animation script -->
    <script>
    (function () {
        const canvas = document.getElementById("bubbleCanvas");
        const ctx = canvas.getContext("2d");

        let w = window.innerWidth;
        let h = window.innerHeight;
        canvas.width = w;
        canvas.height = h;

        // bubbles
        const bubbles = [];
        const COUNT = 40;

        function rand(min, max) {
            return min + Math.random() * (max - min);
        }

        function makeBubble() {
            return {
                x: rand(0, w),
                y: rand(h * 0.5, h + 50), // start lower half
                r: rand(6, 24),           // smaller bubbles
                vy: rand(-0.6, -0.15),    // float UP
                vx: rand(-0.25, 0.25),    // slight drift
                huePick: Math.random(),   // choose purple/pink/orange
                alpha: rand(0.4, 0.9)
            };
        }

        function bubbleColor(huePick) {
            if (huePick < 0.33) {
                // purple
                return { r: 140, g: 0, b: 255 };
            } else if (huePick < 0.66) {
                // hot pink
                return { r: 255, g: 0, b: 204 };
            } else {
                // orange
                return { r: 255, g: 102, b: 0 };
            }
        }

        for (let i = 0; i < COUNT; i++) {
            bubbles.push(makeBubble());
        }

        function draw() {
            ctx.clearRect(0, 0, w, h);

            for (let b of bubbles) {
                // move bubble
                b.x += b.vx;
                b.y += b.vy;

                // recycle bubble if off screen
                if (b.y + b.r < -40 || b.x < -50 || b.x > w + 50) {
                    const fresh = makeBubble();
                    b.x = fresh.x;
                    b.y = h + rand(10, 60);
                    b.r = fresh.r;
                    b.vy = fresh.vy;
                    b.vx = fresh.vx;
                    b.huePick = fresh.huePick;
                    b.alpha = fresh.alpha;
                }

                // glow color
                const col = bubbleColor(b.huePick);

                // outer glow
                const grad = ctx.createRadialGradient(
                    b.x, b.y, b.r * 0.2,
                    b.x, b.y, b.r * 1.4
                );
                grad.addColorStop(0, `rgba(${col.r},${col.g},${col.b},${b.alpha})`);
                grad.addColorStop(1, "rgba(0,0,0,0)");

                ctx.beginPath();
                ctx.fillStyle = grad;
                ctx.arc(b.x, b.y, b.r * 1.4, 0, Math.PI * 2);
                ctx.fill();

                // inner ring
                ctx.beginPath();
                ctx.strokeStyle = `rgba(${col.r},${col.g},${col.b},${Math.min(1,b.alpha+0.2)})`;
                ctx.lineWidth = 2;
                ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
                ctx.stroke();
            }

            requestAnimationFrame(draw);
        }

        function handleResize() {
            w = window.innerWidth;
            h = window.innerHeight;
            canvas.width = w;
            canvas.height = h;
        }

        window.addEventListener("resize", handleResize);
        draw();
    })();
    </script>
</body>
</html>
